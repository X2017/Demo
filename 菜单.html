<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   	<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
    <title>JS树形菜单</title>
    <style type="text/css">
   .menuTree {
        margin-left: 0px;
    }
    
    .menuTree div {
        padding-left: 1px;
    }
    
    .menuTree div ul {
        overflow: hidden;
        display: block;
        height: auto;
        margin: 0;
    }
    
    .menuTree span {
        display: block;
        height: 20px;
        line-height: 25px;
        padding-left: 5px;
        margin: 1px 0;
        cursor: pointer;
        border-bottom: 1px solid #CCC;
    }
    
    .menuTree span:hover {
        background-color: #e6e6e6;
        color: #cf0404;
    }
    
    .menuTree a {
        color: #333;
        text-decoration: none;
    }
    
    .menuTree a:hover {
        color: #06F;
    }
    
    .menuTree span {
        height: 50px;
    }
    </style>
</head>

<body>
    <div id="menuTree" class="menuTree"></div>
</body>

</html>
<script type="text/javascript">
var json = [{
    "name": "1",
    "userLevel": "+ 一级",
    "list": [{
        "name": "2",
        "url": "url_herf",
        "userLevel": "+ 二级",
        "list": [{
            "name": "3",
            "userLevel": "三级"
        }]
    }]
}, {
    "name": "1",
    "userLevel": "+ a一级",
    "list": [{
        "name": "2",
        "url": "url_herf",
        "userLevel": "+ b二级",
        "list": [{
            "name": "3",
            "userLevel": "c三级"
        }]
    }]
}];
var str = "";
var forTree = function(o) {
    for (var i = 0; i < o.length; i++) {
        var urlstr = "";
        try {
            if (typeof o[i]["url"] == "undefined") {
                urlstr = "<div><span>" + o[i]["userLevel"] + o[i]["name"] + "</span><ul>";
            } else {
                urlstr = "<div><span>" + o[i]["userLevel"] + "<a href=" + o[i]["url"] + ">" + o[i]["name"] + "</a></span><ul>";
            }
            str += urlstr;
            if (o[i]["list"] != null) {
                forTree(o[i]["list"]);
            }
            str += "</ul></div>";
        } catch (e) {}
    }
    return str;
}
document.getElementById("menuTree").innerHTML = forTree(json);
/*树形菜单*/
var menuTree = function() {
    //给有子对象的元素加
    $("#menuTree ul").each(function(index, element) {
        var ulContent = $(element).html();
        var spanContent = $(element).siblings("span").html();
        if (ulContent) {
            $(element).siblings("span").html(spanContent)
        }
    });

    $("#menuTree").find("div span").click(function() {
        var ul = $(this).siblings("ul");
        var spanStr = $(this).html();
        var spanContent = spanStr.substr(3, spanStr.length);
        if (ul.find("div").html() != null) {
            if (ul.css("display") == "none") {
                ul.show(300);
                // $(this).html("[-]" + spanContent);
            } else {
                ul.hide(300);
                // $(this).html("[+] " + spanContent);
            }
        }
    })
}()

/*树形列表展开*/
$("#btn_open").on("click",function() {
    $("#menuTree ul").show(300);
    curzt("-");
})

/*收缩*/
$("#btn_close").on("click",function() {
    $("#menuTree ul").hide(300);
    curzt("+");
})

function curzt(v) {
    $("#menuTree span").each(function(index, element) {
        var ul = $(this).siblings("ul");
        var spanStr = $(this).html();
        var spanContent = spanStr.substr(3, spanStr.length);
        if (ul.find("div").html() != null) {
            $(this).html("[" + v + "] " + spanContent);
        }
    });
}




var test = [{
    "iconCls": "new/t-1",
    "id": "4754406",
    "name": "实时监测",
    "pid": "0",
    "url": "/",
    "subFunctionMenuList": [
        [{
            "iconCls": "c_sbjb",
            "id": "4754407",
            "name": "能耗可视化管理",
            "pid": "4754406",
            "subFunctionMenuList": [
                [{
                    "iconCls": "thirdLevelMenu/57",
                    "id": "4754408",
                    "name": "用能分布可视化",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/energyDistributionVisual"
                },{
                    "iconCls": "thirdLevelMenu/56",
                    "id": "123456",
                    "name": "变配电监测33",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/byqSVGMonitor"
                }]
            ],
            "url": "energyMonitor"
        }]
    ],
},
{
    "iconCls": "new/t-1",
    "id": "4754406",
    "name": "实时监测",
    "pid": "0",
    "url": "/",
    "subFunctionMenuList": [
        [{
            "iconCls": "c_sbjb",
            "id": "4754407",
            "name": "能耗可视化管理",
            "pid": "4754406",
            "subFunctionMenuList": [
                [{
                    "iconCls": "thirdLevelMenu/57",
                    "id": "4754408",
                    "name": "用能分布可视化",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/energyDistributionVisual"
                },{
                    "iconCls": "thirdLevelMenu/56",
                    "id": "123456",
                    "name": "变配电监测33",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/byqSVGMonitor"
                }]
            ],
            "url": "energyMonitor"
        },
        {
            "iconCls": "c_sbjb",
            "id": "4754407",
            "name": "能耗可视化管理",
            "pid": "4754406",
            "subFunctionMenuList": [
                [{
                    "iconCls": "thirdLevelMenu/57",
                    "id": "4754408",
                    "name": "用能分布可视化",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/energyDistributionVisual"
                },{
                    "iconCls": "thirdLevelMenu/56",
                    "id": "123456",
                    "name": "变配电监测33",
                    "pid": "4754407",
                    "subFunctionMenuList": [
                        [

                        ]
                    ],
                    "url": "energyMonitor/byqSVGMonitor"
                }]
            ],
            "url": "energyMonitor"
        }]
    ],
}
];


/*=======================递归 start==============*/

var obj = new Object();//new 一个obj 对象
obj.html = "";
obj.menu_tree = function (id, array){
    if (array!=undefined) {
        for (var i = 0; i < array.length; i++) {
            if (id == array[i].pid) {
                obj.html += "<div><span>" + array[i].name + "</span><ul>";
            }
            if (array[i].subFunctionMenuList != undefined) {
                obj.menu_tree(array[i].id, array[i].subFunctionMenuList[0]);
            }
            obj.html += "</ul></div>";
        };
    };
};
obj.menu_tree(0, test);
document.getElementById("menuTree").innerHTML = obj.html;
/*=======================递归 end==============*/





/*var str = "";
var forTree = function(o) {
    for (var i = 0; i < o.length; i++) {
        var urlstr = "";
        try {
        	console.log(o[i]);
            if ( o[i]["subFunctionMenuList"].length > 0 ) {
                urlstr = "<div><span>" + o[i]["name"] + "</span><ul>";
            } else {
                urlstr = "<div><span>"+ "<a href=" + o[i]["url"] + ">" + o[i]["name"] + "</a></span><ul>";
            }
            str += urlstr;
            //if (o[i]["lisubFunctionMenuListst"].length > 0) {
                forTree(o[i]["lisubFunctionMenuListst"]);
          //  }
            str += "</ul></div>";
        } catch (e) {}
    }
    return str;
}
console.log(forTree(test[0]['subFunctionMenuList'][0]));*/


// console.log(addNav(test[0]['subFunctionMenuList'][0]));
function addNav(data){ //添加左边菜单项 默认选中第一个二级菜单
	$.each(data, function(i, sm){
		var menulist = "";
		menulist += '<li>';
		$.each(sm.subFunctionMenuList[0], function(j,o){
			menulist += '<li><div><a ref="' + o.id + '" href="#" rel="'
					+ o.url + '" ><span class="LeftMenuImg" style="background:url('+2+'/images/'+o.iconCls+'.png) no-repeat;"></span><span class="nav">' + o.name
					+ '</span></a></div></li> ';
					//menulist += '';
		});
		menulist += '</li>';
		console.log(sm.name);
		console.log(menulist);
	});
}
</script>

